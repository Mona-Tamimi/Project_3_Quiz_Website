<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- html2canvas Library -->

    <style>
        body {
            background-color: #C2FAF1;
            /* display: flex;
            flex-direction: column; */
            /* justify-content: space-around; */
            /* align-items: center; */
            /* height: 100vh; */
            font-family: Arial, Helvetica, sans-serif;
            /* overflow: hidden; */
        }
        #alldiv{
            display: flex;
            flex-direction: column;
            align-items: center;

        }

        #finish {
            background-color: #fff;
            padding: 2vw 2vw;
            border-radius: 20px;
            margin: 15vw 15vw 0vw 15vw;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            animation: fadeIn 1.5s ease-in-out;
        }

        h2 {
            color: #295e6a;
            font-size: 1.8rem;
            margin-bottom: 20px;
            animation: slideDown 1s ease-out;
        }

        #btn-seeResult {
            background-color: #295e6a;
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 50px;
            animation: slideDown 1s ease-out;
        }

        #btn-GoToHome {
            background-color: #295e6a;
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 50px;
            animation: slideDown 1s ease-out;
        }

        #btn-downloadResult {
            color: #295e6a;
            padding: 10px 20px;
            font-size: 1rem;
        }

        #btn-backToTests {
            color: #295e6a;
            padding: 10px 20px;
            font-size: 1rem;
        }

        #btn-GoToHome:hover {
            background-color: #4A4A4A;
            color: #C2FAF1;
            font-size: 1.1rem;
        }

        #btn-seeResult:hover {
            background-color: #4A4A4A;
            color: #C2FAF1;
            font-size: 1.1rem;
        }

        #btn-backToTests:hover {
            color: #4A4A4A;
            font-size: 1.1rem;
        }

        #btn-downloadResult:hover {
            color: #4A4A4A;
            font-size: 1.1rem;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideDown {
            from {
                transform: translateY(-10vw);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }

            to {
                opacity: 0;
                transform: scale(0.9);
            }
        }

        #container {
            display: none;
            margin: 5vw 15vw;
            background-color: #fff;
            padding: 2vw 2vw;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            animation: fadeIn 1.5s ease-in-out;

        }
    </style>
    <!-- <script>
        // دالة لتحميل المحتوى من ملف خارجي
        function loadContent() {
            // تحميل الهيدر
            fetch('header.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header').innerHTML = data;
                });

            // تحميل الفوتر
            fetch('footer.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('footer').innerHTML = data;
                });
        }

        // استدعاء الدالة عند تحميل الصفحة
        window.onload = loadContent;
    </script> -->
</head>

<body>
    <!-- <div id="header"></div> -->

    <div id="alldiv">
        <section id="finish">
            <h2 class="text-center">Well done! You have finished the test.</h2>
            <button id="btn-seeResult" onclick="hideSection()" class="btn" aria-label="See the test result">See
                result</button>
        </section>
        <div id="container">
            <h1 id="result-title"></h1>
            <p id="score"></p>
            <div id="answers-table-container"></div>
            <a href="index.html" id="btn-backToTests">Back To Tests</a>
            <a href="apply-test.html" id="btn-GoToHome">Go To Home</a><br><br>
            <a href="" id="btn-downloadResult" onclick="downloadPDF()">Download Result as PDF</a>
        </div>
    </div>
    <!-- <div style="width: 100vw; height: 3vw; background-color: #C2FAF1;margin-top: 4vw;"> </div> -->
    <!-- <div id="footer"></div> -->


    <script>
        function hideSection() {
            const section = document.getElementById("finish");

            section.style.animation = "fadeOut 1s ease";
            // section.style.visibility = "hidden";

            section.addEventListener("animationend", () => {

                section.style.marginTop = '3vw';
                document.getElementById("container").style.display = "block";
                document.getElementById("btn-seeResult").style.display = "none";
                document.body.style.overflow = 'auto';
            });

            // const testResults1 = {
            //     testId: "english",
            //     userAnswers: [0, 1, 0, 1, 2, 1, 1, 1, 1, 1]
            // };


            // localStorage.setItem('testResults', JSON.stringify(testResults1));


            const testResults = JSON.parse(localStorage.getItem('user1'));
            if (!testResults) {  //ensure that there is result in local storage
                alert('No test results found. Please complete the test first.');
                window.location.href = 'index.html'; // redirect user to home page
            }
            const testId = testResults.selectedTest;
            const userAnswers = testResults.userAnswers;

            fetch(`json/${testId}.json`)
                .then(response => response.json())
                .then(questions => {
                    const correctAnswers = questions.map(q => q.correctOptionIndex);
                    const score = userAnswers.filter((ans, i) => ans === correctAnswers[i]).length;

                    const resultTitle = document.getElementById('result-title');
                    const scoreElement = document.getElementById('score');

                    if (score >= 6) {
                        resultTitle.textContent = 'Congratulations!';
                        document.body.style.backgroundColor = '#C2FAF1';
                        scoreElement.textContent = `You passed with a score of ${score} out of ${questions.length}.`;
                    } else {
                        resultTitle.textContent = 'Unfortunately!';
                        document.body.style.backgroundColor = '#f8d7da';
                        scoreElement.textContent = `You did not fulfill our requirements, Good Luck. `;
                        scoreElement.textContent += `Your score ${score} out of ${questions.length}.`;
                    }

                    const tableContainer = document.getElementById('answers-table-container');
                    let tableHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Your Answer</th>
                                <th>Correct Answer</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                    questions.forEach((question, i) => {
                        const isCorrect = userAnswers[i] === correctAnswers[i];
                        tableHTML += `
                        <tr>
                            <td>${question.question}</td>
                            <td style="color: ${isCorrect ? 'green' : 'red'};">${question.options[userAnswers[i]] || 'No Answer'}</td>
                            <td style="color: green;">${question.options[correctAnswers[i]]}</td>
                        </tr>
                    `;
                    });

                    tableHTML += '</tbody></table>';
                    tableContainer.innerHTML = tableHTML;
                });
        }
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Add title to the PDF
            const resultTitle = document.getElementById('result-title').textContent;
            doc.text(resultTitle, 10, 10);

            // Add score
            const scoreText = document.getElementById('score').textContent;
            doc.text(scoreText, 10, 20);

            // Add the answers table to the PDF
            const tableContainer = document.getElementById('answers-table-container');
            const rows = tableContainer.querySelectorAll('table tr');
            let yPosition = 30; // Start position for the table in the PDF

            rows.forEach(row => {
                const cols = row.querySelectorAll('td, th');
                const rowData = Array.from(cols).map(col => col.textContent);
                doc.text(rowData.join(' | '), 10, yPosition);
                yPosition += 10;
            });

            // Save the PDF
            doc.save('test_results.pdf');
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- loader -->
    <!-- <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px">
            <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee" />
            <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
                stroke="#F96D00" />
        </svg></div> -->
    <!-- <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/scrollax.min.js"></script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
    <script src="js/google-map.js"></script>
    <script src="js/main.js"></script> -->
</body>

</html